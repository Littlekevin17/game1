<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>üè∞ Ch√¢teau volant ‚Äì Calculs magiques</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: 'Comic Sans MS', cursive;
      background: linear-gradient(to bottom, #cde2ff, #f7e7ff);
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 0;
      min-height: 100vh;
      text-align: center;
      color: #3b1a57;
      padding: 20px;
    }

    h1 {
      margin: 20px 0;
    }

    .question {
      margin: 20px 0;
      background: #fff;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 0 10px #aaa;
      max-width: 500px;
      width: 90%;
    }

    .question p {
      font-size: 1.2rem;
      margin-bottom: 10px;
    }

    input[type="number"] {
      padding: 8px 12px;
      font-size: 1.1rem;
      border-radius: 10px;
      border: 2px solid #f2a365;
      width: 100px;
      text-align: center;
    }

    button {
      background: #3b1a57;
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 20px;
      font-size: 1.1rem;
      cursor: pointer;
      margin: 10px;
    }

    button:hover {
      background: #4a2677;
    }

    #result {
      font-size: 1.3rem;
      margin: 20px;
    }

    .btn-container {
      display: flex;
      gap: 20px;
      margin-top: 30px;
      flex-wrap: wrap;
      justify-content: center;
    }
	
	@media (max-width: 600px) {
	  body {
		padding: 4vw 2vw;
	  }
	  h1 {
		font-size: 1.1rem;
		margin: 12px 0;
	  }
	  .question {
		padding: 10px 4vw;
		border-radius: 10px;
		font-size: 0.98rem;
		max-width: 98vw;
		margin: 12px 0;
	  }
	  .question p {
		font-size: 1rem;
		margin-bottom: 6px;
	  }
	  input[type="number"] {
		width: 60vw;
		max-width: 120px;
		font-size: 1rem;
		padding: 8px 0;
		border-radius: 8px;
	  }
	  button {
		width: 90vw;
		max-width: 340px;
		font-size: 1rem;
		margin: 8px 0;
		padding: 10px 0;
		border-radius: 16px;
	  }
	  #result {
		font-size: 1.05rem;
		margin: 12px 0;
	  }
	  .btn-container {
		gap: 10px;
		margin-top: 20px;
		flex-direction: column;
		align-items: stretch;
	  }
	}
  </style>
</head>
<body>
  <h1>üè∞ Ch√¢teau volant ‚Äì Calculs magiques</h1>

  <form id="quiz-form"></form>

  <div id="result"></div>

  <div class="btn-container">
    <button id="retry-btn">üîÑ Rejouer</button>
    <button onclick="window.location.href='carte.html'">‚Üê Retour √† la carte</button>
  </div>

  <!-- Sons -->
  <audio id="sound-win" src="sounds/win.mp3"></audio>
  <audio id="sound-fail" src="sounds/fail.mp3"></audio>

  <script>
    const allQuestions = [
      { text: "üêâ Un dragon a 3 t√™tes. Chaque t√™te crache 4 flammes. Combien de flammes ?", answer: 12 },
      { text: "üßô‚Äç‚ôÇÔ∏è Le mage poss√®de 2 grimoires. Chaque grimoire contient 25 sorts. Combien de sorts ?", answer: 50 },
      { text: "üïØÔ∏è Tu allumes 5 chandelles et souffles-en 2. Combien restent allum√©es ?", answer: 3 },
      { text: "ü¶Ñ Une licorne a 4 sabots. Combien ont 3 licornes ?", answer: 12 },
      { text: "üßö‚Äç‚ôÄÔ∏è Une f√©e donne 7 √©toiles par jour. En 5 jours ?", answer: 35 },
      { text: "üê∏ 6 grenouilles. Chacune a 4 pattes. Total de pattes ?", answer: 24 },
      { text: "üßµ Une araign√©e tisse 2 toiles/jour. En 7 jours ?", answer: 14 },
      { text: "üëë 4 princesses avec 3 bagues chacune. Total ?", answer: 12 },
      { text: "ü¶â 3 hiboux. 1 s‚Äôenvole. Combien en reste-t-il ?", answer: 2 },
      { text: "üçÑ 5 lutins trouvent 2 champignons chacun. Total ?", answer: 10 },
      { text: "üê∫ 4 loups. Chacun mange 3 g√¢teaux. Combien au total ?", answer: 12 },
      { text: "üîÆ 6 boules de cristal. Chacune √©claire 5 minutes. Total de minutes ?", answer: 30 },
      { text: "ü¶Ö 2 aigles ont 7 plumes dor√©es chacun. Combien de plumes ?", answer: 14 },
      { text: "üßõ Un vampire dort 9h/jour. Combien en 3 jours ?", answer: 27 },
      { text: "üßü 4 zombies font 2 pas par minute. Combien de pas en 1 minute ?", answer: 8 },
      { text: "üê∫ Un loup crie 3 fois par nuit. Combien en 4 nuits ?", answer: 12 },
      { text: "üßù‚Äç‚ôÇÔ∏è 5 elfes tirent 2 fl√®ches chacun. Total de fl√®ches ?", answer: 10 },
      { text: "‚öóÔ∏è Une potion demande 3 gouttes rouges et 2 bleues. Combien de gouttes au total ?", answer: 5 },
      { text: "üëª 7 fant√¥mes volent 3 fois chacun. Total de vols ?", answer: 21 },
      { text: "üï∏Ô∏è 8 araign√©es font 2 toiles chacune. Total ?", answer: 16 },
      { text: "ü¶¢ 5 cygnes pondent 1 ≈ìuf chacun. Total ?", answer: 5 },
      { text: "üèπ 6 archers d√©cochent 4 fl√®ches chacun. Total ?", answer: 24 },
      { text: "ü¶¥ 3 squelettes perdent 6 os chacun. Combien d‚Äôos ?", answer: 18 },
      { text: "üåï 1 nuit magique dure 10 heures. Combien 2 nuits ?", answer: 20 },
      { text: "üê† 4 poissons magiques ont 3 √©cailles brillantes chacun. Total ?", answer: 12 },
      { text: "üê¶ 3 oiseaux chantent 2 chansons chacun. Total ?", answer: 6 },
      { text: "üé© 2 magiciens ont 4 chapeaux chacun. Combien de chapeaux ?", answer: 8 },
      { text: "üßû‚Äç‚ôÇÔ∏è 1 g√©nie exauce 3 v≈ìux. 2 g√©nies ?", answer: 6 },
      { text: "üåà Il faut 7 couleurs pour un arc-en-ciel. Combien pour 2 ?", answer: 14 },
      { text: "üë† 3 f√©es laissent 1 chaussure chacune. Total ?", answer: 3 }
    ];

    const quizForm = document.getElementById('quiz-form');
    const resultDiv = document.getElementById('result');
    const retryBtn = document.getElementById('retry-btn');
    const soundGood = document.getElementById('sound-good');
    const soundBad = document.getElementById('sound-bad');
    let selectedQuestions = [];

    function getRandomQuestions(count) {
      const shuffled = [...allQuestions].sort(() => Math.random() - 0.5);
      return shuffled.slice(0, count);
    }

    function displayQuestions() {
      quizForm.innerHTML = '';
      resultDiv.textContent = '';
      selectedQuestions = getRandomQuestions(5);

      selectedQuestions.forEach((q, index) => {
        const div = document.createElement("div");
        div.className = "question";
        div.innerHTML = `
          <p>${q.text}</p>
          <input type="number" name="q${index}" required />
        `;
        quizForm.appendChild(div);
      });

      const submitBtn = document.createElement("button");
      submitBtn.type = "submit";
      submitBtn.textContent = "‚ú® Valider mes r√©ponses";
      quizForm.appendChild(submitBtn);
    }

	quizForm.addEventListener("submit", function (e) {
      e.preventDefault();
      let score = 0;

      selectedQuestions.forEach((q, index) => {
        const input = quizForm.elements["q" + index];
        const value = parseInt(input.value);
        if (value === q.answer) {
          score += 20;
        }
        input.disabled = true;
      });

      resultDiv.textContent = `üéâ Bravo ! Ton score magique est : ${score}/100`;
      saveProgress(score);
      quizForm.querySelector("button[type='submit']").disabled = true;

      // üéµ Joue le bon son final
      if (score === 100) {
        document.getElementById('sound-win').play();
      } else {
        document.getElementById('sound-fail').play();
      }
    });

    function saveProgress(score) {
      const progress = JSON.parse(localStorage.getItem("progressionForetEtoiles") || "{}");
      progress["chateau_volant"] = {
        termin√©: true,
        score: score,
        objet: "Grimoire √©tincelant"
      };
      localStorage.setItem("progressionForetEtoiles", JSON.stringify(progress));
    }

    retryBtn.addEventListener("click", () => {
      displayQuestions();
    });

    displayQuestions();
  </script>
</body>
</html>
